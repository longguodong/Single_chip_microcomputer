C51 COMPILER V9.01   DS18B20                                                               11/29/2017 13:04:52 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN ds18b20.OBJ
COMPILER INVOKED BY: D:\专业软件安装\keil\C51\BIN\C51.EXE ds18b20.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "ds18b20.h"
   2          #include <intrins.h>
   3          
   4          long temp; 
   5          void delay(unsigned char i)                                //短延时
   6          {
   7   1              while(--i);
   8   1      }
   9          
  10          void Init_Ds18b20(void)     //DS18B20初始化send reset and initialization command
  11          {
  12   1      
  13   1      DQ=1;                     //总线短暂拉高
  14   1      delay(1); 
  15   1      DQ=0;                     //主机发出低电平
  16   1      delay(250);     //低电平持续800us左右，检测总线有没有低电平,
  17   1      DQ=1;
  18   1      delay(100);     //等待120us
  19   1                                             
  20   1      }
  21          
  22          uchar Read_One_Byte()       //读取一个字节的数据read a byte date
  23          
  24          {
  25   1              uchar i   = 0;
  26   1              uchar dat = 0;
  27   1              for(i=8;i>0;i--)  //读取8次，从低到高
  28   1              {
  29   2                      DQ = 0;        //拉高总线1us后释放         
  30   2                      _nop_();                
  31   2                      dat >>= 1;       //依次右移      
  32   2                      DQ = 1;          //释放总线  
  33   2                      delay(1);               
  34   2                      if(DQ)                  
  35   2                      {
  36   3                              dat |= 0x80;        
  37   3                      }
  38   2                      delay(10);             
  39   2              }
  40   1              return (dat);
  41   1      }
  42          
  43          void Write_One_Byte(uchar dat)
  44          {
  45   1              uchar i = 0;
  46   1              for(i=8;i>0;i--)
  47   1              {
  48   2                      DQ = 0;        //拉低总线1us                
  49   2                      _nop_();           
  50   2                      DQ = dat&0x01;  //将数据写到总线             
  51   2                      delay(10);      //采样60us            
  52   2                      DQ = 1;                        
  53   2                      dat >>= 1;
  54   2              delay(1);
  55   2              }
C51 COMPILER V9.01   DS18B20                                                               11/29/2017 13:04:52 PAGE 2   

  56   1      }
  57          
  58          uint Get_Tmp()                   
  59          {
  60   1              float tt;
  61   1              uchar a,b;
  62   1              Init_Ds18b20();                
  63   1              Write_One_Byte(0xcc);     //主机发出复位指令    
  64   1              Write_One_Byte(0x44);     //跳过ROM 
  65   1              Init_Ds18b20();           //再次初始化    
  66   1              Write_One_Byte(0xcc);     //主机发出复位操作并接受存在脉冲   
  67   1              Write_One_Byte(0xbe);      //跳过ROM   
  68   1              a = Read_One_Byte();       //读取低位   
  69   1              b = Read_One_Byte();       //读取高位   
  70   1              temp = b;                  
  71   1              temp <<= 8;                 //高位左移8次 
  72   1              temp = temp|a;              //读取低位  
  73   1              tt = temp*0.0625;           
  74   1              temp = tt*10+0.5;                       //数据处理，四舍五入    
  75   1              return temp;
  76   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    236    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
